
 <%-include("../../views/partials/admin/main") %>

 <style>
  #categoryChart, #brandChart {
    max-width: 250px;
    margin: 0 auto;
  }
</style>


   <link rel="stylesheet" href="/css/bootstrap.min.css">

   <h2>ðŸ“Š Admin Dashboard</h2>
 
   <form action="/admin/dashboard" method="GET" class="d-flex gap-2 mb-4">
     <select name="filter" class="form-select w-auto">
       <option value="yearly" <%= filter==='yearly'?'selected':'' %>>Yearly</option>
       <option value="monthly" <%= filter==='monthly'?'selected':'' %>>Monthly</option>
       <option value="weekly" <%= filter==='weekly'?'selected':'' %>>Weekly</option>
       <option value="daily" <%= filter==='daily'?'selected':'' %>>Daily</option>
     </select>
     <button class="btn btn-primary">Filter</button>
   </form>
 
   <canvas id="salesChart" height="100"></canvas>
 
   <hr />
 
   <div class="row">
     <div class="col-md-4">
       <h5>Top 10 Products</h5>
       <ul class="list-group">
         <% productSales.forEach(p => { %>
           <li class="list-group-item d-flex justify-content-between">
             <%= p.name %>
             <span><%= p.totalQty %></span>
           </li>
         <% }) %>
       </ul>
     </div>
 
     
      <div class="col-md-4">
        <h6 class="text-center">Sales by Category</h6>
        <canvas id="categoryChart" width="250" height="250"></canvas>
      </div>
      <div class="col-md-4">
        <h6 class="text-center">Sales by Brand</h6>
        <canvas id="brandChart" width="250" height="250"></canvas>
      </div>
  

   </div>

   

   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

   <script>
    document.addEventListener("DOMContentLoaded", () => {
      const ctx = document.getElementById('salesChart').getContext('2d');
      const salesData = <%- JSON.stringify(salesData) %>;
  
      if (!salesData || !salesData.length) {
        console.log("No sales data available");
        return;
      }
  
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: salesData.map(s => s.date),
          datasets: [{
            label: 'Total Sales (â‚¹)',
            data: salesData.map(s => s.total),
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            tension: 0.4, // smooth curve
            fill: true, // make it area chart
            borderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Sales Trend Over Time' }
          },
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    });
  </script>
  
<script>
  const categoryLabels = <%- JSON.stringify(categorySales.map(c => c._id)) %>;
  const categoryData = <%- JSON.stringify(categorySales.map(c => c.totalQty)) %>;

  const brandLabels = <%- JSON.stringify(brandSales.map(b => b._id)) %>;
  const brandData = <%- JSON.stringify(brandSales.map(b => b.totalQty)) %>;

  const categoryCtx = document.getElementById("categoryChart").getContext("2d");
  new Chart(categoryCtx, {
    type: "doughnut",
    data: {
      labels: categoryLabels,
      datasets: [{
        data: categoryData,
        backgroundColor: ["#36A2EB", "#FF6384", "#FFCE56", "#4BC0C0"],
        hoverOffset: 6
      }]
    },
    options: {
      plugins: {
        legend: {
          position: "bottom",
          labels: { boxWidth: 15 }
        }
      }
    }
  });

  const brandCtx = document.getElementById("brandChart").getContext("2d");
  new Chart(brandCtx, {
    type: "doughnut",
    data: {
      labels: brandLabels,
      datasets: [{
        data: brandData,
        backgroundColor: ["#FF9F40", "#9966FF", "#FF6384", "#36A2EB", "#4BC0C0"],
        hoverOffset: 6
      }]
    },
    options: {
      plugins: {
        legend: {
          position: "bottom",
          labels: { boxWidth: 15 }
        }
      }
    }
  });
</script>
  

 