<%- include("../partials/user/header") %>

  <div class="container" style="margin-top:10rem;">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb p-2 rounded">
        <li class="breadcrumb-item">
          <a href="/userProfile" class="text-decoration-none">Profile</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">My Orders</li>
      </ol>
    </nav>

    <div class="row">
      <div class="col-6">
        <h2 class="mb-4">My Orders</h2>
      </div>
      <div class="col-6">
        <div class="mb-4" style="    width: 100%;">
          <form action="/orders" method="GET" class="d-flex gap-2">
            <input type="text" name="search" class="form-control" placeholder="Search orders..."
              value="<%= query?.search || '' %>">
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="/orders" class="btn btn-secondary">Reset</a>
          </form>
        </div>

      </div>
    </div>


    <% if (orders.length===0) { %>
      <div class="text-center py-5">
        <h5>You havenâ€™t placed any orders yet.</h5>
        <a href="/products" class="btn btn-primary mt-3">Shop Now</a>
      </div>
      <% } else { %>
        <% orders.forEach(order=> { %>
          <div class="card mb-4 shadow-sm rounded">

            <!-- Order Header -->
            <div class="card-header d-flex justify-content-between align-items-center">
              <div>
                <strong>Order No : <%= order.orderId %></strong><br>
                <small>
                  <%= order.createdAt.toDateString() %>
                </small>
              </div>
              <a href="/order/<%= order._id %>" class="btn btn-link">View Details</a>
            </div>

            <!-- Ordered Products -->
            <div class="card-body">
              <% order.orderedItems.forEach(item=> { %>
                <div class="d-flex align-items-center border-bottom py-2">

                  <!-- Product Image -->
                  <div class="me-3">
                    <img src="<%= item.image %>" alt="product"
                      style="width:60px; height:60px; object-fit:cover; border-radius:6px;">
                  </div>

                  <!-- Product Info -->
                  <div class="flex-grow-1">
                    <h6 class="mb-1">
                      <%= item.productName %>
                    </h6>
                    <small class="text-muted">Size: <%= item.size %></small>
                  </div>

                  <% if(item.status==="Order Not Placed" ){ %>
                    <div class="col-5" style="background-color: #f0f5ff;
                    border: 1px solid #2a55e5;padding-left: 12px;border-radius: 5px;">
                      <small>Payment not successful. Please contact your bank for any money deducted</small>
                    </div>
                    <% } %>

                      <div class="col-2">
                        <p></p>
                      </div>

                      <!-- Status -->
                      <div>
                        <small>
                          <span class="fw-bold <%= order.status === 'Delivered' ? 'text-success' : 'text-primary' %>">
                            <%= item.status %>
                          </span>
                        </small>
                        <% if(order.deliveredAt){ %>
                          <br><small>Delivered on <%= order.deliveredAt.toDateString() %></small>
                          <% } %>
                      </div>
                </div>
                <% }) %>
            </div>

          </div>
          <% }) %>
            <% } %>
  </div>

  <%- include("../partials/user/footer") %>